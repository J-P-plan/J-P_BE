<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ÏùºÏ†ï ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f6f9;
            color: #333;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background-color: #407BFF;
            color: #fff;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .details {
            padding: 20px;
        }

        .map {
            width: 100%;
            height: 300px;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            font-size: 16px;
            color: #407BFF;
            background-color: #eaf0ff;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tab:hover, .tab.active {
            background-color: #407BFF;
            color: #fff;
        }

        .day-schedule {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .day-schedule .time {
            font-size: 14px;
            color: #407BFF;
            font-weight: bold;
        }

        .day-schedule .place {
            flex: 1;
            padding: 0 15px;
            font-size: 16px;
            color: #333;
        }

        .day-schedule .icon {
            font-size: 20px;
            color: #407BFF;
            cursor: pointer;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
        }

        .button {
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #407BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #365db8;
        }

        #scheduleDetails {
            font-size: 14px;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 10px;
            white-space: pre-wrap;
            overflow: auto;
            max-height: 300px;
        }
    </style>
    <script>
        let socket;
        let scheduleData;
        const token = "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG5hdmVyLmNvbSIsInJvbGUiOlsiVVNFUiJdLCJleHAiOjE3MzAyNjExMzh9.Fovxq6ROm6_Cl_Typ676DGEzjs8LFMBAiyQdgd_6HRI";

        function connectWebSocket() {
            socket = new WebSocket("wss://localhost:8080/ws");
            socket.onopen = () => console.log("WebSocket Ïó∞Í≤∞Ïù¥ Ïó¥Î†∏ÏäµÎãàÎã§.");
            socket.onmessage = (event) => location.reload();
            socket.onclose = () => console.log("WebSocket Ïó∞Í≤∞Ïù¥ Îã´ÌòîÏäµÎãàÎã§.");
            socket.onerror = (error) => console.error("WebSocket Ïò§Î•ò: ", error);
        }

        function disconnectWebSocket() {
            if (socket) socket.close();
        }

        // Ïû•ÏÜå Ï∂îÍ∞Ä API Ìò∏Ï∂ú Ìï®Ïàò
                async function addLocation(dayId) {
                    const newLocation = [
                        {
                            time: "14:30",
                            location: { lat: 37.5511694, lng: 126.9882266 },
                            placeId: "ChIJsYmocVaifDUR99wwIJ9jOmU",
                            name: "ÎÇ®ÏÇ∞ÏÑúÏö∏ÌÉÄÏõå"
                        }
                    ];

                    try {
                        const response = await fetch(`https://localhost:8080/schedule/location/${dayId}`, {
                            method: "POST",
                            headers: {
                                "Authorization": token,
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(newLocation)
                        });

                        if (!response.ok) throw new Error("Ïû•ÏÜå Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§");

                        const result = await response.json();

                        if (result) {
                            console.log("Ïû•ÏÜåÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.");
                            socket.send("Ïú†Ï†ÄÍ∞Ä Ïû•ÏÜåÎ•º Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§."); // WebSocketÏùÑ ÌÜµÌï¥ ÏÑúÎ≤ÑÏóê Î©îÏãúÏßÄ Ï†ÑÏÜ°
                        }

                        fetchScheduleDetails(1); // Ïã§Ï†ú scheduleIdÎ°ú ÍµêÏ≤¥

                    } catch (error) {
                        console.error("Ïû•ÏÜå Ï∂îÍ∞Ä Ïò§Î•ò: ", error);
                    }
                }

        async function fetchScheduleDetails(scheduleId) {
            try {
                const response = await fetch(`https://localhost:8080/schedule/${scheduleId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": token,
                        "Content-Type": "application/json"
                    }
                });
                if (!response.ok) throw new Error("ÏùºÏ†ï Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§");
                scheduleData = await response.json();
                renderScheduleDetails(1); // Display Day 1 by default
            } catch (error) {
                console.error("ÏùºÏ†ï Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò: ", error);
            }
        }

        function renderScheduleDetails(dayIndex) {
            const dayDetailsContainer = document.getElementById("dayDetails");
            dayDetailsContainer.innerHTML = ""; // Clear previous content

            const day = scheduleData.dayResDtos.find(d => d.dayIndex === dayIndex);
            if (!day) return; // If no data for the day, exit

            day.dayLocationResDtoList.forEach(location => {
                const locationElement = document.createElement("div");
                locationElement.className = "day-schedule";
                locationElement.innerHTML = `
                    <div class="time">${location.time}</div>
                    <div class="place">${location.name}</div>
                    <div class="icon">üìç</div>
                `;
                dayDetailsContainer.appendChild(locationElement);
            });
        }

        window.onload = () => {
            connectWebSocket();
            fetchScheduleDetails(1); // Replace with actual schedule ID as needed
        };

        window.onunload = () => {
            disconnectWebSocket();
        };


    </script>
</head>
<body>
    <div class="container">
        <div class="header">ÎÇ®Ìï¥ Ïó¨Ìñâ ÏùºÏ†ï</div>
        <div class="details">
            <div class="map">ÏßÄÎèÑ ÌëúÏãú ÏòÅÏó≠</div>

            <div class="tabs">
                <div class="tab active" onclick="renderScheduleDetails(1)">Day 1</div>
                <div class="tab" onclick="renderScheduleDetails(2)">Day 2</div>
                <div class="tab" onclick="renderScheduleDetails(3)">Day 3</div>
                <div class="tab" onclick="renderScheduleDetails(4)">Day 4</div>
            </div>

            <div id="dayDetails"></div>
        </div>

        <div class="buttons">
            <button class="button" onclick="addLocation(1)">Ïû•ÏÜå Ï∂îÍ∞Ä</button>
            <button class="button" onclick="deleteLocation(1)">Ïû•ÏÜå ÏÇ≠Ï†ú</button>
            <button class="button" onclick="updateSchedule(1)">ÏùºÏ†ï ÏóÖÎç∞Ïù¥Ìä∏</button>
        </div>
    </div>
</body>
</html>
